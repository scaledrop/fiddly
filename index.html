<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fiddly: Online HTML, CSS and JS Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" itemprop="description" content="Test your Javascript, CSS and HTML online with Fiddly code editor. Fiddly is a playground for web developers and designers or even beginners.">
    <style>
    * {
        margin: 0;
        padding: 0;
        outline: 0;
    }
    body {
        font-family: monospace;
        background: #fff;
    }
    ul{list-style-type: none;}
    .wrapper {
        background: #f5f5f5;
        border: 0;
    }
    .half {
        width: 50%;
        float: left;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    .wrapper.half {
        padding: 20px 60px 30px 40px;
    }
    .wrapper.half h2 {
        color: #666
    }
    .wrapper textarea {
        width: 100%;
        margin: 10px auto 20px auto;
        padding: 10px;
        min-height: 150px;
        max-height: 400px;
        border:1px solid #aaa;
        resize: auto;
        overflow: auto;
        font-size: 14px;
        font-family: monospace;
        line-height: 1.6;
        color: #666;
        background: #fafafa;
    }
    .wrapper textarea:focus {
        background: #fff
    }
    #output.half {
        padding: 0
    }
    .output {
        overflow: hidden;
    }
    #rh {
        position: absolute;
        top: 52px;
        right: 0;
        bottom: 0;
        width: 50%;
        height: 100%;
    }
    .top-controls {
        position: fixed;
        top:0;
        z-index: 10;
        background: #fff;
        width: 100%;
        padding: 10px 0px 10px 10px;
    }
    .sb{display: none}
    .ctrls {
        padding: 7px 0;
        font-size: 14px;
        text-align: center;
        width: 75px;
        border: 0;
        text-transform: uppercase;
    }
    #runBtn {
        float: left;
        background: #666;
        color: #fff;
    }
    #resetBtn {
        background: #eee;
        color: #666;
    }
    #saveBtn{
        float: left;
        background: #ccc;
        color: #333;
    }
    #outframe {
        border: none;
        width: 100%;
        height: 100%;
    }
    #outframe body {
        padding: 0;
        width: auto;
    }
    .info{
        position:fixed;
        z-index: 10;
        left:35%;
        right:auto;
        top:35%;
        display:none;
        width: 30%;
        min-width: 250px;
        max-width: 300px;
        padding: 20px;
        background: #fff;
        box-shadow: 0 5px 50px rgba(0, 0, 0, 0.3);
        -webkit-box-shadow: 0 5px 50px rgba(0, 0, 0, 0.3);
        -moz-box-shadow: 0 5px 50px rgba(0, 0, 0, 0.3);
        border: solid 1px #ACB3B9;
    }
    .info.visible{display:block}
    .info h3{
        font-family: arial;
        font-size: 1em;
        margin-bottom: 1em;
    }
    .shortcuts li{
        padding-bottom: 12px;
        border-bottom: 1px solid #e6e6e6;
        margin-bottom: 10px;
        width: 200px;
    }
    .shortcuts li code{
            border: solid 1px #ABABAB;
            font-size: 10px;
            font-family: sans;
            padding: 2px 4px;
            border-radius: 3px;
            color: #999;
    }
    .shortcuts li span{
        font-family: Arial;
        font-size: 14px;
        padding-left: 10px;
    }
    .about-fiddly li{
        float: left;
        margin-right: 12px;
        color: #ccc;
    }
    .about-fiddly li a{
        font-size: 11px;
        color: #ccc;
        text-decoration: none;
    }
    .about-fiddly li a:hover{color: #888;text-decoration: underline;}
    .help{
        color: #ccc;
        padding: 2px 6px;
        cursor: pointer;
        font-size: 12px;
        line-height: 19px;
        position: fixed;
        border-radius: 0 3px 0 0;
        right: 0;
        top: 13px;
        z-index: 100;
        text-align: center;
        background: #fff;
    }
    .help:hover{color: #888}
    .close-help{
        position: absolute;
        right: 0;
        top: 0;
        color: #aaa;
        font-size: 18px;
        padding: 5px 15px;
        cursor: pointer;
    }
    .close-help:hover{color: #888}
    @media screen and (max-width: 600px){
        .wrapper textarea{margin: 10px auto}
        .ctrls{
            font-size: 12px;
            width: 60px;
        }
            .info{left: 27.5%}
    }
      @media screen and (max-width: 500px){
        .ctrls{
            font-size: 14px;
            width: 33.33%;
        }
        .half{
            width: 100%;
        }
        #rh{
            position: relative;
            top:0;
            margin-bottom: 30px;
            width:100%;
        }
        .top-controls{
            bottom: 0;
            top: auto;
            padding: 0px;
            width: 100%;
        }
        .help{position: absolute;}
        .info{left: 0;width: 90%;max-width: none;}
        
    }
    @media screen and (max-height: 700px){
        .wrapper textarea{min-height: 130px}
    }
    @media screen and (max-height: 600px){
        .wrapper textarea{min-height: 110px}
    }
    @media screen and (max-height: 500px){
        .wrapper textarea{min-height: 80px}
    }
    </style>
    <script>
    </script>
</head>

<body>
    <div class="wrapper half" id="lh">
        <form>
            <h2>HTML</h2>
            <textarea id="html" class="codeBlock" placeholder="enter your markup here.." autofocus ></textarea>
            <h2>CSS</h2>
            <textarea id="css" class="codeBlock" placeholder="put your style here.."></textarea>
            <h2>JS</h2>
            <textarea id="js" class="codeBlock" placeholder="add your script here.."></textarea>
        </form>
        <div id="help" class="help">Help ?</div>
        <div class="info" id="info">
                    <h3>Keyboard Shortcuts</h3>
                    <ul class="shortcuts">
                        <li><code>CTRL</code> + <code>Return</code> <span>Run fiddly</span></li>
                        <li><code>CTRL</code> + <code>S</code> <span>Save fiddly</span></li>
                        <li><code>CTRL</code> + <code>E</code> <span>Clear fiddly</span></li>
                    </ul>
                    <div class="about-fiddly">
                        <ul>
                            <li><a href="http://github.com/scaledrop/fiddly" title="Fork GitHub repo">GitHub</a></li>
                            <li><a href="http://scaledrop.net" title="Read posts">Blog</a></li>
                            <li><a href="http://twitter.com/scaledrop" title="Follow on Twitter">Twitter</a></li>
                            <li><a href="http://scaledrop.com/test" title="Responsive design testing tool">Test RWD</a></li>
                        </ul>
                    </div>
                <span class="close-help" id="close">-</span>
        </div>
    </div>
    <div class="output half" id="output">
        <div class="top-controls">
            <button class="ctrls" id="runBtn"><span class="lb">Run</span><span class="sb">R</span>
                <span class="btnkeys"></span>
            </button>
            <button class="ctrls" id="saveBtn"><span class="lb">Save</span><span class="sb">S</span>
                <span class="btnkeys"></span>
            </button>
            <button class="ctrls" id="resetBtn"><span class="lb">Clear</span><span class="sb">C</span>
                <span class="btnkeys"></span>
            </button>
            
        </div>
        <div id="rh">
            <iframe id="outframe" sandbox="allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
        </div>
    </div>
    <script>
    window.onload = function() {
        if (typeof addEventListener !== "undefined") {
            addEvent = function(obj, evt, fn) {
                obj.addEventListener(evt, fn, false);
            };
            removeEvent = function(obj, evt, fn) {
                obj.removeEventListener(evt, fn, false);
            };
        } else if (typeof attachEvent !== "undefined") {
            addEvent = function(obj, evt, fn) {
                var fnHash = "e_" + evt + fn;
                obj[fnHash] = function() {
                    var type = event.type,
                        relatedTarget = null;
                    if (type === "mouseover" || type === "mouseout") {
                        relatedTarget = (type === "mouseover") ? event.fromElement : event.toElement;
                    }
                    fn.call(obj, {
                        target: event.srcElement,
                        type: type,
                        relatedTarget: relatedTarget,
                        _event: event,
                        preventDefault: function() {
                            this._event.returnValue = false;
                        },
                        stopPropagation: function() {
                            this._event.cancelBubble = true;
                        }
                    });
                };
                obj.attachEvent("on" + evt, obj[fnHash]);
            };
        }
        var d = document,
            getId = function(id) {
                return d.getElementById(id);
            },
            // localStorage = {},
            fetch = function(str) {
                // if(checkif.supportLocalStorage())
                return localStorage.getItem(str);
            },
            set = function(str, arg) {
                return localStorage.setItem(str, arg);
            };
        var run = getId("runBtn"),
            reset = getId("resetBtn"),
            hc = getId("html"),
            cc = getId("css"),
            jc = getId("js"),
            fc = getId("outframe"),
            save = getId("saveBtn"),
            help = getId("help"),
            info = getId("info"),
            close = getId("close");
        var createEl = function(name) {
            return d.createElement(name);
        };
        var outst = createEl("style"),
            outjs = createEl("script");
        outjs.type = 'text/javascript';

        var output = {
            // check if iframe
            isFrame: function() {
                var outdoc = fc.contentDocument || fc.contentWindow.d;
                return outdoc;
            },
            // run input code
            elval: function(eh, ec, ej, est, ejs, edoc) {
                var hh = eh.value,
                    ch = ec.value,
                    jh = ej.value.replace(/[\n\t\r]/g,""); // remove tabs or returns if there any
                if (output.isFrame()) {
                    edoc.getElementsByTagName('head')[0].appendChild(est);
                    est.innerHTML = ch;
                    var iFrameBody = edoc.getElementsByTagName('body')[0];
                    iFrameBody.innerHTML = hh;
                    if (iFrameBody) {
                        ejs.innerHTML = jh;
                        iFrameBody.appendChild(ejs);
                        edoc.location.href = "javascript:" + jh;
                    }
                }
            },
            // clear output and inputs
            emval: function(eh, ec, ej, est, ejs, edoc) {
                var hh = eh.value,
                    ch = ec.value,
                    jh = ej.value;
                eh.value = ec.value = ej.value = est.innerHTML = edoc.body.innerHTML = "";
                if (checkif.supportLocalStorage()) {                                    
                    localStorage.clear();
                } else {
                    alert("Your browser doesn't support localStorage. Try either Chrome, Firefox or Safari browser.");
                }
                if (output.isFrame()) {
                    var iFrameScript = edoc.getElementsByTagName('script')[0];
                    if (iFrameScript) {
                        iFrameScript.parentNode.removeChild(iFrameScript);
                    }
                    eh.focus();
                }
            }
        };
        var events = {
            // bind events
            attachEvents: function() {
                output.elval(hc, cc, jc, outst, outjs, output.isFrame());
            },
            // unbind events
            dettachEvents: function() {
                output.emval(hc, cc, jc, outst, outjs, output.isFrame());
            }
        };
        var bindKey = {
            // shortcuts for mac and unix
            bindMUKeys: function(e) {
                var ev = window.event || e;
                var key = ev.charCode || ev.keyCode;
                
                switch (key) {
                        case 13: // ctrl+return
                            ev.ctrlKey ? 
                            events.attachEvents()
                            : false;
                            break;
                        case 69: // ctrl+e
                            ev.ctrlKey ? 
                            events.dettachEvents()
                            : false;
                            break;
                        case 83: // ctrl+s
                            ev.ctrlKey || ev.metaKey ?
                            saveFun.fileLocally()
                            : false;
                            break;
                        case 27: // Escape
                            saveFun.triggerHelp.hide(info)
                            break;

                        default:
                            break;
                    }
            },
            // shortcuts for windows and linux
            bindWLKeys: function(e) {
                var ev = window.event || e;
                var key = ev.charCode || ev.keyCode;

                    switch (key) {
                        case 13: // ctrl+return
                            ev.ctrlKey ? 
                            events.attachEvents()
                            : false;
                            break;
                        case 69: // ctrl+e
                            ev.ctrlKey ? 
                            (function(){
                                events.dettachEvents();
                                ev.preventDefault();
                                return false;
                            })()
                            :
                            false;
                            break;
                        case 83: // ctrl+s
                            ev.ctrlKey || ev.metaKey ?
                            (function() {
                                saveFun.fileLocally();
                                ev.preventDefault();
                                return false;
                            })()
                            :
                            false;
                            break;
                        case 27: // Escape
                            saveFun.triggerHelp.hide(info)
                            break;

                        default:
                            break;
                    }
            }
        };
        var checkif = {
            // test navigator
            isOS: function(os) {
                // mac or unix
                if (os.indexOf("X11") !=-1 || os.indexOf("Mac") !=-1) 
                    return bindKey.bindMUKeys;

                // windows or linux
                if (os.indexOf("Win") !=-1 || os.indexOf("Linux") !=-1) 
                    return bindKey.bindWLKeys;
            },
            supportLocalStorage: function() {
                return typeof(Storage)!== 'undefined';
            }
        };
        var saveFun = {
            // save using localstorage
            fileLocally: function() {
                if (checkif.supportLocalStorage()) {                                    
                    if (hc.value) set("hc", hc.value);
                    if (cc.value) set("cc", cc.value);
                    if (jc.value) set("jc", jc.value);
                    var min_val = hc.value || cc.value || jc.value ;
                    if(min_val) alert("Your code's been saved!");
                } else {
                    alert("Your browser doesn't support localStorage. Try either Chrome, Firefox or Safari browser.");
                }
            },
            fileOnserver: function() {

            },
            getLocalData: function() {
                // hc.value = cc.value = jc.value = "";
                if (checkif.supportLocalStorage()) {
                    // Note: below lines'll stop you to run the whole code if you're using this locally on IE and old Firefox. IE hates it if you try to access localstorage on local file ie- file://
                    // Bug Ref: https://bugzilla.mozilla.org/show_bug.cgi?id=507361
                    // Fix: start your local server
                    fetch("hc") ? hc.value = localStorage.getItem("hc") : "";
                    fetch("cc") ? cc.value = localStorage.getItem("cc") : "";
                    fetch("jc") ? jc.value = localStorage.getItem("jc") : "";
                }else {
                    alert("Your browser doesn't support localStorage. Try either Chrome, Firefox or Safari browser.");
                }
            },
            triggerHelp: {
                show: function(source, target, minimize){
                    if(target.style.display != "block") { target.style.display = "block"; }
                    else target.style.display = "none";
                  }, 
                hide: function(target) {
                    target.style.display = "none"
                } 
                    
            }
        };
        // Add indentation on tab and reurn
        var utilities = {
                indentation: function(e) {
                    var tab = "\t";
                    var tabWidth = tab.length;
                    if (e.keyCode === 9) {
                        e.preventDefault();
                        var start = this.selectionStart,
                            end = this.selectionEnd;
                        if (e.shiftKey === false) {
                            if (!utilities.ifReturn(this)) {
                                this.value = this.value.substring(0, start) + tab + this.value.slice(start);
                                this.selectionStart = start + tabWidth;
                                this.selectionEnd = end + tabWidth;
                            } else {
                                var startIn = utilities.startPoint(this),
                                    l = startIn.length,
                                    newStart = undefined,
                                    newEnd = undefined,
                                    affectedRows = 0;
                                while(l--) {
                                    var _thresold = startIn[l];
                                    if (startIn[l+1] && start != startIn[l+1]) _thresold = startIn[l+1];

                                    if (_thresold >= start && startIn[l] < end) {
                                        this.value = this.value.slice(0, startIn[l]) + tab + this.value.slice(startIn[l]);

                                        newStart = startIn[l];
                                        if (!newEnd) newEnd = (startIn[l+1] ? startIn[l+1] - 1 : 'end');
                                        affectedRows++;
                                    }
                                }
                                this.selectionStart = newStart;
                                this.selectionEnd = (newEnd !== 'end' ? newEnd + (tabWidth * affectedRows) : this.value.length);
                            }
                        } 
                        else {
                            // Shift-Tab reverse indentation
                            if (!utilities.ifReturn(this)) {
                                if (this.value.substr(start - tabWidth, tabWidth) == tab) {
                                    this.value = this.value.substr(0, start - tabWidth) + this.value.substr(start);
                                    this.selectionStart = start - tabWidth;
                                    this.selectionEnd = end - tabWidth;
                                } else if (this.value.substr(start - 1, 1) == "\n" && this.value.substr(start, tabWidth) == tab) {
                                    this.value = this.value.substring(0, start) + this.value.substr(start + tabWidth);
                                    this.selectionStart = start;
                                    this.selectionEnd = end - tabWidth;
                                }
                            } else {
                                var startIn = utilities.startPoint(this),
                                    l = startIn.length, newStart, newEnd,
                                    affectedRows = 0;
                                while(l--) {
                                    var _thresold = startIn[l];
                                    if (startIn[l+1] && start != startIn[l+1]) _thresold = startIn[l+1];

                                    if (_thresold >= start && startIn[l] < end) {
                                        if (this.value.substr(startIn[l], tabWidth) == tab) {
                                            this.value = this.value.slice(0, startIn[l]) + this.value.slice(startIn[l] + tabWidth);
                                            affectedRows++;
                                        } else {}
                                        newStart = startIn[l];
                                        if (!newEnd) newEnd = (startIn[l+1] ? startIn[l+1] - 1 : 'end');
                                    }
                                }
                                this.selectionStart = newStart;
                                this.selectionEnd = (newEnd !== 'end' ? newEnd - (affectedRows * tabWidth) : this.value.length);
                            }
                        }
                    } 
                    else if (e.keyCode === 13 && e.shiftKey === false) {    // Enter, maintain current position
                        var self = utilities,
                            cursorPos = this.selectionStart,
                            startIn = self.startPoint(this),
                            numstartIn = startIn.length,
                            startIndex = 0,
                            endIndex = 0,
                            tabMatch = new RegExp("^" + tab.replace('\t', '\\t').replace(/ /g, '\\s') + "+", 'g'),
                            lineText = '';
                            tabs = null;
                        for(var x=0;x<numstartIn;x++) {
                            if (startIn[x+1] && (cursorPos >= startIn[x]) && (cursorPos < startIn[x+1])) {
                                startIndex = startIn[x];
                                endIndex = startIn[x+1] - 1;
                                break;
                            } else {
                                startIndex = startIn[numstartIn-1];
                                endIndex = this.value.length;
                            }
                        }
                        lineText = this.value.slice(startIndex, endIndex);
                        tabs = lineText.match(tabMatch);
                        if (tabs !== null) {
                            e.preventDefault();
                            var indentText = tabs[0];
                            var indentWidth = indentText.length;
                            var inLinePos = cursorPos - startIndex;
                            if (indentWidth > inLinePos) {
                                indentWidth = inLinePos;
                                indentText = indentText.slice(0, inLinePos);
                            }
                            this.value = this.value.slice(0, cursorPos) + "\n" + indentText + this.value.slice(cursorPos);
                            this.selectionStart = cursorPos + indentWidth + 1;
                            this.selectionEnd = this.selectionStart;
                        }
                    }
            },
            ifReturn: function(el) {
                var val = el.value.slice(el.selectionStart, el.selectionEnd),
                    nlRegex = new RegExp(/\n/);
                if (nlRegex.test(val)) return true;
                else return false;
            },
            startPoint: function(el) {
                var text = el.value,
                    startIn = [],
                    offset = 0;
                while(text.match(/\n/) && text.match(/\n/).length > 0) {
                    offset = (startIn.length > 0 ? startIn[startIn.length - 1] : 0);
                    var lineEnd = text.search("\n");
                    startIn.push(lineEnd + offset + 1);
                    text = text.substring(lineEnd + 1);
                }
                startIn.unshift(0);
                return startIn;
            },
            indent_: function(el) {
                var elem = document.querySelectorAll(el);
                for (var i=0;i<elem.length;i+=1){
                var self = elem[i];
                    if (self.nodeName === 'TEXTAREA') {
                        self.addEventListener('keydown', utilities.indentation);
                    }
                }
            }
}
        // trigger events
        saveFun.getLocalData();
        utilities.indent_('.codeBlock');
        addEvent(help, "click", function() {
            saveFun.triggerHelp.show(help, info, close)
        });
        addEvent(close, "click", function() {
            saveFun.triggerHelp.hide(info)
        })
        addEvent(run, "click", events.attachEvents);
        addEvent(reset, "click", events.dettachEvents);
        addEvent(save, "click", function(){ saveFun.fileLocally();});
        addEvent(d, "keydown", checkif.isOS(navigator.appVersion));
    };
    </script>
</body>

</html>
